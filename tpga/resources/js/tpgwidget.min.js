"use strict";function scrollTo(e,t,a){var n=e.scrollTop,o=t-n,i=0;!function t(){i+=20;var r=Math.easeInOutQuad(i,n,o,a);e.scrollTop=r,i<a&&setTimeout(t,20)}()}function genererAutocomplete(e,t){f7.autocomplete({openIn:"page",opener:$(".itineraire-"+e),backOnSelect:!0,source:function(e,t,a){var n=[];if(0!==t.length){for(var o=0;o<stops.length;o++)stops[o].toLowerCase().indexOf(t.toLowerCase())>=0&&n.push(stops[o]);a(n)}else a(stops)},onOpen:function(){$(".autocomplete-page .searchbar-input input").focus()},onChange:function(t,a){$(".itineraire-"+e).find(".item-after").text(a[0]),$(".itineraire-"+e).find("input").val(a[0])},pageTitle:t,backText:"Retour",notFoundText:"Aucun arrêt trouvé",searchbarPlaceholderText:"Rechercher…",searchbarCancelText:"Annuler",requestSourceOnOpen:!0})}var f7=new Framework7({material:!0,statusbarOverlay:!1,scrollTopOnStatusbarClick:!0,cache:!1,notificationCloseIcon:!1}),$=Dom7,stops=[],mainView=f7.addView(".view-main",{});$(document).on("ajaxStart",function(e){f7.showPreloader("Chargement...")}),$(document).on("ajaxComplete",function(){f7.hidePreloader()}),f7.device.android&&(window.oncontextmenu=function(e){return e.preventDefault(),e.stopPropagation(),!1});var isStandalone=window.matchMedia("(display-mode: standalone)").matches;f7.device.android&&!isStandalone?($(".left").remove(),$(".center").text("TPGwidget"),$(".page-content").html('<div class="content-block">\n        <p>Pour installer un raccourci pour l’arrêt <strong>'+$(".center").text()+'</strong> :</p>\n        <ul class="tutorial">\n            <li>\n                <div class="step-number">1</div>\n                <p>Appuyez sur le bouton <strong>Plus <i class="more"></i></strong> tout en haut à droite de l\'écran</p>\n            </li>\n            <li>\n                <div class="step-number">2</div>\n                <p>Sélectionnez <strong>Ajouter à l’écran d’accueil</strong></p>\n                <img src="/resources/img/ath.png" alt="Ajouter à l’écran d’accueil">\n            </li>\n        </ul>\n    </div>'),$(".page-index").removeClass("layout-dark")):($.ajax({url:"/ajax/ajaxprochainsdeparts.php?id="+$(".page-index").attr("data-page").split("-")[1],cache:!1,success:function(e){$(".page-content").html(e),$(".page-index").removeClass("layout-dark")},error:function(){$(".preloader").addClass("smileyErreur"),$(".preloader").removeClass("preloader"),$(".preloader-white").removeClass("preloader-white"),$(".page-content").html('<div class="graym"><h2>Erreur</h2><span>Impossible de se connecter au serveur TPGwidget</span></div>')}}),$(document).on("pageBeforeAnimation",function(e){function t(e){$("meta[name=theme-color]").remove(),$("head").append('<meta name="theme-color" content="'+e+'">')}f7.closeNotification(".notifications");var a=e.detail.page.name.split("-");"infotraffic"==a[0]&&$(".pull-to-refresh-content").on("refresh",function(e){$.ajax({url:"/ajax/ajaxperturbations.php",cache:!1,success:function(e){$("#perturbations-all").html(e),f7.pullToRefreshDone()}})}),t("depart"==a[0]?a[1]:"vehicule"==a||"itineraire"==a?"#333":"#F60")}),$(document).on("pageAfterAnimation",function(e){var t=e.detail.page,a=t.name.split("-");if("depart"===a[0]&&"left"!==t.from){var n=$(".page-depart .page-content");scrollTo(n[0],Math.min($(".current").offset().top-88,n[0].scrollHeight-n.height()),500)}"depart"===a[0]&&$(".pdata").length&&($(t.container).find(".page-content").css("padding-bottom","150px"),$(".pdata").length>0&&f7.addNotification({message:$(".pdata").html(),button:!1})),"page"!=a[0]&&"index"!=a[0]||$.ajax({url:"/ajax/ajaxprochainsdeparts.php?id="+a[1],cache:!1,success:function(e){$(t.container).find(".page-content").html(e),$(".page-page, .page-index").removeClass("layout-dark")}})}),$(document).on("click",".show-m",function(e){$(".show-h").removeClass("active"),$(".show-m").addClass("active"),$(".h").hide(),$(".m").show(),$(".tab-link-highlight").css("transform","translate3d(0%, 0px, 0px)")}),$(document).on("click",".show-h",function(e){$(".show-m").removeClass("active"),$(".show-h").addClass("active"),$(".h").show(),$(".m").hide(),$(".tab-link-highlight").css("transform","translate3d(100%, 0px, 0px)")}),window.addEventListener("popstate",function(e){history.pushState(null,null,window.location.pathname),mainView.router.back()},!1)),f7.onPageInit("arrets",function(){$.ajax({url:"/arrets/arrets.json",dataType:"json",success:function(e){f7.virtualList(".virtual-list",{items:e,template:'<li><a href="/ajax/page/{{stopCode}}/{{stopName}}" class="item-link"><div class="item-content"><div class="item-inner"><div class="item-title">{{stopName}}</div></div></div></a></li>',searchAll:function(e,t){for(var a=[],n=0;n<t.length;n++)(t[n].stopCode.toLowerCase().indexOf(e.toLowerCase().trim())>=0||t[n].stopName.toLowerCase().indexOf(e.toLowerCase().trim())>=0)&&a.push(n);return a}})}}),"geolocation"in navigator?($(".location-message").hide(),$(".enable-geolocation").show(),$(".enable-geolocation").on("click",function(){$(".enable-geolocation").hide(),$(".location-message").css("display","flex"),navigator.geolocation.getCurrentPosition(function(e){$.ajax({url:"/arrets/geolocation.json",dataType:"json",data:{latitude:e.coords.latitude,longitude:e.coords.longitude},success:function(e){if(0==e.length)$(".location-message .item-title").text("Aucun arrêt proche trouvé");else{$(".location-message").hide();for(var t=0;t<e.length;t++){var a=e[t],n='<li><a href="/ajax/page/'+a.stopCode+"/"+a.stopName+'" class="item-link item-content"><div class="item-media"><i class="icon icon-location"></i></div><div class="item-inner"><div class="item-title">'+a.stopName+"</div></div></a></li>";$(".arrets-location ul").append(n)}}}})},function(){$(".location-message .item-title").text("Impossible d'obtenir votre position")})})):$(".arrets-location").remove(),$("#arrets-search").on("keyup",function(){""!==$(this).val().trim()?$(".arrets-location").hide():$(".arrets-location").show()})}),f7.onPageInit("itineraire",function(){$("form.ajax-submit").on("submitted",function(e){mainView.router.load({content:e.detail.data.replace(/SCREENWIDTH/g,screen.width)})}),$(".itineraire-invert").on("click",function(){var e=$('input[name="depart"]').val(),t=$('input[name="arrivee"]').val();$('input[name="depart"]').val(t),$(".itineraire-depart .item-after").text(""!==t?t:"Cliquez pour choisir"),$('input[name="arrivee"]').val(e),$(".itineraire-arrivee .item-after").text(""!==e?e:"Cliquez pour choisir")}),0===stops.length&&$.ajax({url:"/itineraire/stops.json",method:"GET",dataType:"json",success:function(e){stops=e}}),genererAutocomplete("depart","Départ"),genererAutocomplete("arrivee","Arrivée")}),f7.onPageInit("trajets",function(){new Swiper(".swiper-container",{pagination:".swiper-pagination"})}),Math.easeInOutQuad=function(e,t,a,n){return(e/=n/2)<1?a/2*e*e+t:(e--,-a/2*(e*(e-2)-1)+t)};